# ะัััััะน ััะฐัั: ะะฝัะตััะตัั (MLO)

## ๐ ะะฟะธัะฐะฝะธะต

ะะพะดัะปั ะธะฝัะตััะตัะพะฒ ะฟะพะทะฒะพะปัะตั ัะฟัะฐะฒะปััั MLO (Multi-Level Objects) - ะธะฝัะตััะตัะฐะผะธ ะธะท GTA V. ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะฐััะถะธะฒะฐะตั ะธะฝัะตััะตัั ะฒ ะฐััะธะฒะฐั ะฟัะธ ะธั ะธะฝะดะตะบัะฐัะธะธ.

---

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### 1. ะัะพัะผะพัั ะธะฝัะตััะตัะพะฒ

1. ะัะบัะพะนัะต ะฟะฐะฝะตะปั MeshHub (F10)
2. ะะตัะตะนะดะธัะต ะฝะฐ ะฒะบะปะฐะดะบั "ะะฝัะตััะตัั"
3. ะัะฑะตัะธัะต ะธััะพัะฝะธะบ:
   - **HUB** - ะธะฝัะตััะตัั ั ัะตัะฒะตัะฐ hub.feeld.space
   - **GTAV** - ะฑะฐะทะพะฒัะต ะธะฝัะตััะตัั GTA V (ัะบะพัะพ)
   - **Local** - ัััะฐะฝะพะฒะปะตะฝะฝัะต ะปะพะบะฐะปัะฝะพ ะธะฝัะตััะตัั (ัะบะพัะพ)

### 2. ะฃััะฐะฝะพะฒะบะฐ ะธะฝัะตััะตัะฐ

1. ะะฐะถะผะธัะต ะบะฝะพะฟะบั "ะกะบะฐัะฐัั" ะฝะฐ ะฝัะถะฝะพะผ ะธะฝัะตััะตัะต
2. ะะพะถะดะธัะตัั ะทะฐะฒะตััะตะฝะธั ัััะฐะฝะพะฒะบะธ (ััะฐััั ะธะทะผะตะฝะธััั ะฝะฐ "ะฃััะฐะฝะพะฒะปะตะฝ")
3. ะะฝัะตััะตั ะฑัะดะตั ัััะฐะฝะพะฒะปะตะฝ ะฒ ะฟะฐะฟะบั `hubresource/interiors/`

### 3. ะัะพัะผะพัั ะปะพะบะฐัะธะน ะธะฝัะตััะตัะฐ

1. ะะฐะถะผะธัะต ะฝะฐ ะบะฐััะพัะบั ะธะฝัะตััะตัะฐ ะดะปั ัะฐัะบัััะธั
2. ะั ัะฒะธะดะธัะต ัะฟะธัะพะบ ะฒัะตั ะปะพะบะฐัะธะน (ะฟะพะทะธัะธะน) ะธะฝัะตััะตัะฐ
3. ะะฐะถะดะฐั ะปะพะบะฐัะธั ะฟะพะบะฐะทัะฒะฐะตั:
   - ะะฐะทะฒะฐะฝะธะต archetype
   - ะะพะพัะดะธะฝะฐัั X, Y, Z
   - ะะฐัะตะณะพัะธั (ะตัะปะธ ะพะฟัะตะดะตะปะตะฝะฐ)

### 4. ะขะตะปะตะฟะพััะฐัะธั ะบ ะธะฝัะตััะตัั

1. ะะฐัะบัะพะนัะต ะดะตัะฐะปะธ ะธะฝัะตััะตัะฐ
2. ะะฐะถะผะธัะต ะฝะฐ ะธะบะพะฝะบั ัะตะปะตะฟะพััะฐ (๐) ััะดะพะผ ั ะฝัะถะฝะพะน ะปะพะบะฐัะธะตะน
3. ะั ะฑัะดะตัะต ะฟะตัะตะผะตัะตะฝั ะบ ะธะฝัะตััะตัั

---

## ๐ง ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะฐััะถะตะฝะธะต

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะฐััะถะธะฒะฐะตั ะธะฝัะตััะตัั ะฟัะธ ะธะฝะดะตะบัะฐัะธะธ ะฐััะธะฒะพะฒ:

1. **ะัะธ ะทะฐะณััะทะบะต ะฐััะธะฒะฐ** - ัะธััะตะผะฐ ัะบะฐะฝะธััะตั YMAP ัะฐะนะปั
2. **ะะพะธัะบ CMloInstanceDef** - ะพะฟัะตะดะตะปัะตั ะพะฑัะตะบัั ัะธะฟะฐ `CMloInstanceDef`
3. **ะกะพััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั** - ัะพััะฐะฝัะตั ะฟะพะทะธัะธะธ ะธ ะผะตัะฐะดะฐะฝะฝัะต ะฒ ะะ
4. **ะะฑะฝะพะฒะปะตะฝะธะต ััะฐัััะฐ** - ะฟะพะผะตัะฐะตั ะฐััะธะฒ ะบะฐะบ ัะพะดะตัะถะฐัะธะน ะธะฝัะตััะตัั

### ะงัะพ ะธะทะฒะปะตะบะฐะตััั ะธะท YMAP:

```xml
<Item type="CMloInstanceDef">
  <archetypeName>baze_int_dealership_echelon_col</archetypeName>
  <position x="1680.5336" y="3588.8337" z="39.76234" />
  <rotation x="0" y="0" z="0" w="1" />
  <lodDist value="200" />
  <guid value="930630" />
  <flags value="1572864" />
</Item>
```

ะะทะฒะปะตะบะฐัััั ะฟะพะปั:
- `archetypeName` - ะฝะฐะทะฒะฐะฝะธะต ะธะฝัะตััะตัะฐ
- `position` - ะบะพะพัะดะธะฝะฐัั X, Y, Z
- `rotation` - ัะพัะฐัะธั (ะบะฒะฐัะตัะฝะธะพะฝ)
- `lodDist` - ะดะธััะฐะฝัะธั LOD
- `guid` - ัะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั
- `flags` - ัะปะฐะณะธ ะพะฑัะตะบัะฐ

---

## ๐ก API Endpoints

### Backend (Go)

- `GET /api/rpf/mlo` - ะกะฟะธัะพะบ ะฐััะธะฒะพะฒ ั ะธะฝัะตััะตัะฐะผะธ
- `GET /api/rpf/mlo/{id}` - ะะตัะฐะปะธ ะธะฝัะตััะตัะฐ (ะฐััะธะฒะฐ)
- `POST /api/rpf/mlo/{id}/scan` - ะะฐะฟัััะธัั ัะบะฐะฝะธัะพะฒะฐะฝะธะต ะฐััะธะฒะฐ
- `GET /api/rpf/mlo/stats` - ะกัะฐัะธััะธะบะฐ ะฟะพ ะธะฝัะตััะตัะฐะผ

### ะัะธะผะตั ะพัะฒะตัะฐ API:

```json
{
  "success": true,
  "interiors": [
    {
      "id": "uuid",
      "name": "baze_dealership",
      "displayName": "Baze Dealership",
      "resourceType": "mlo",
      "size": 15728640,
      "interiorCount": 1,
      "interiors": [
        {
          "id": "uuid",
          "archetypeName": "baze_int_dealership_echelon_col",
          "position": {
            "x": 1680.5336,
            "y": 3588.8337,
            "z": 39.76234
          },
          "rotation": {
            "x": 0,
            "y": 0,
            "z": 0,
            "w": 1
          },
          "lodDist": 200,
          "category": "shop"
        }
      ]
    }
  ],
  "total": 1
}
```

---

## ๐ฎ ALT:V ะกะพะฑััะธั

### WebView โ Client

- `meshhub:interior:download` - ะกะบะฐัะฐัั ะธะฝัะตััะตั
- `meshhub:interior:teleport` - ะขะตะปะตะฟะพััะธัะพะฒะฐัััั ะบ ะธะฝัะตััะตัั
- `meshhub:interior:check` - ะัะพะฒะตัะธัั ัััะฐะฝะพะฒะบั
- `meshhub:interior:list:request` - ะะฐะฟัะพัะธัั ัะฟะธัะพะบ ัััะฐะฝะพะฒะปะตะฝะฝัั

### Client โ WebView

- `meshhub:interior:download:response` - ะัะฒะตั ะฝะฐ ัะบะฐัะธะฒะฐะฝะธะต
- `meshhub:interior:check:response` - ะัะฒะตั ะฝะฐ ะฟัะพะฒะตัะบั
- `meshhub:interior:list:response` - ะกะฟะธัะพะบ ัััะฐะฝะพะฒะปะตะฝะฝัั ะธะฝัะตััะตัะพะฒ

### Client โ Server

- `meshhub:interior:download` - ะะฐะฟัะพั ะฝะฐ ัะบะฐัะธะฒะฐะฝะธะต (ะฟะตัะตััะปะฐะตััั ะฝะฐ ัะตัะฒะตั)

### Server โ Client

- `meshhub:interior:download:server:response` - ะัะฒะตั ะฟะพัะปะต ัะบะฐัะธะฒะฐะฝะธั

---

## ๐ ะกัััะบัััะฐ ััะฐะฝะตะฝะธั

```
altv-server/
โโโ hubresource/
    โโโ interiors/
        โโโ baze_dealership/
        โ   โโโ dlc.rpf
        โโโ apartment_complex/
        โ   โโโ dlc.rpf
        โโโ warehouse_interior/
            โโโ dlc.rpf
```

---

## ๐ ะะฐัะตะณะพัะธะทะฐัะธั ะธะฝัะตััะตัะพะฒ

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปัะตั ะบะฐัะตะณะพัะธั ะธะฝัะตััะตัะฐ ะฟะพ ะฝะฐะทะฒะฐะฝะธั archetype:

| ะะฐัะตะณะพัะธั | ะะปััะตะฒัะต ัะปะพะฒะฐ | ะขะตะณะธ |
|-----------|----------------|------|
| Shop | shop, store, dealership | commercial |
| Warehouse | warehouse, storage | industrial |
| Office | office, building | business |
| Residential | house, apartment, condo | housing |
| Garage | garage, parking | vehicle |
| Entertainment | club, bar, casino | nightlife |
| Other | ะฒัะต ะพััะฐะปัะฝัะต | - |

---

## โ๏ธ ะะตัะตะธะฝะดะตะบัะฐัะธั ะฐััะธะฒะพะฒ

**ะะพัะปะต ะพะฑะฝะพะฒะปะตะฝะธั backend ะฟะพััะตะฑัะตััั ะฟะตัะตะธะฝะดะตะบัะฐัะธั:**

### ะะฐัะธะฐะฝั 1: ะงะตัะตะท UI (rpf-frontend)

1. ะัะบัะพะนัะต `http://hub.feeld.space`
2. ะะตัะตะนะดะธัะต ะฒ "ะะฐััะพะฒะฐั ะพะฑัะฐะฑะพัะบะฐ"
3. ะะฐะฟัััะธัะต ะฟะตัะตะธะฝะดะตะบัะฐัะธั ั ะพะฟัะธัะผะธ:
   - โ Convert to XML
   - โ Index Content
   - โ Force Reindex

### ะะฐัะธะฐะฝั 2: ะงะตัะตะท API

```bash
POST https://hub.feeld.space/api/rpf/archives/{id}/reindex
```

### ะะฐัะธะฐะฝั 3: ะะฒัะพะผะฐัะธัะตัะบะฐั (ะฟัะธ ะฝะพะฒัั ะฐััะธะฒะฐั)

ะะพะฒัะต ะฐััะธะฒั ะฑัะดัั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะบะฐะฝะธัะพะฒะฐัััั ะฝะฐ ะธะฝัะตััะตัั ะฟัะธ ะธะฝะดะตะบัะฐัะธะธ.

---

## ๐พ ะะฐะทะฐ ะดะฐะฝะฝัั

### ะะพะฒัะต ัะฐะฑะปะธัั:

#### `rpf_interiors`
ะฅัะฐะฝะธั ะธะฝัะพัะผะฐัะธั ะพะฑ ะธะฝัะตััะตัะฐั, ะธะทะฒะปะตัะตะฝะฝัั ะธะท YMAP ัะฐะนะปะพะฒ.

#### ะะพะฒัะต ะฟะพะปั ะฒ `rpf_archives`:
- `has_interior` (BOOLEAN) - ัะพะดะตัะถะธั ะปะธ ะฐััะธะฒ ะธะฝัะตััะตัั
- `interior_count` (INTEGER) - ะบะพะปะธัะตััะฒะพ ะธะฝัะตััะตัะพะฒ
- `interior_metadata` (JSONB) - ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ะผะตัะฐะดะฐะฝะฝัะต

### ะัะตะดััะฐะฒะปะตะฝะธั:

- `rpf_interiors_with_archive` - ะธะฝัะตััะตัั ั ะธะฝัะพัะผะฐัะธะตะน ะพะฑ ะฐััะธะฒะต

---

## ๐ ะขัะฐะฑะปัััะธะฝะณ

### ะะฝัะตััะตัั ะฝะต ะพัะพะฑัะฐะถะฐัััั

1. ะัะพะฒะตัััะต, ััะพ ะฐััะธะฒั ะฟัะพะธะฝะดะตะบัะธัะพะฒะฐะฝั
2. ะฃะฑะตะดะธัะตัั, ััะพ YMAP ัะฐะนะปั ะบะพะฝะฒะตััะธัะพะฒะฐะฝั ะฒ XML
3. ะัะพะฒะตัััะต ะปะพะณะธ backend ะฝะฐ ะฝะฐะปะธัะธะต ะพัะธะฑะพะบ ะฟะฐััะธะฝะณะฐ

### ะขะตะปะตะฟะพััะฐัะธั ะฝะต ัะฐะฑะพัะฐะตั

1. ะฃะฑะตะดะธัะตัั, ััะพ ะฒั ะฒ ALT:V (ะฝะต ะฒ ะฑัะฐัะทะตัะต)
2. ะัะพะฒะตัััะต, ััะพ ะธะฝัะตััะตั ัััะฐะฝะพะฒะปะตะฝ
3. ะัะพะฒะตัััะต ะบะพะฝัะพะปั ะฝะฐ ะฝะฐะปะธัะธะต ะพัะธะฑะพะบ

### ะกะบะฐัะธะฒะฐะฝะธะต ะทะฐะฒะธัะปะพ

1. ะัะพะฒะตัััะต ัะพะตะดะธะฝะตะฝะธะต ั backend
2. ะฃะฑะตะดะธัะตัั, ััะพ ัะพะบะตะฝ ะฐะฒัะพัะธะทะฐัะธะธ ะฒะฐะปะธะดะตะฝ
3. ะัะพะฒะตัััะต ะปะพะณะธ ัะตัะฒะตัะฐ ALT:V

---

## ๐ ะกัะฐัะธััะธะบะฐ

ะะพะปััะธัั ััะฐัะธััะธะบั ะฟะพ ะธะฝัะตััะตัะฐะผ:

```bash
GET https://hub.feeld.space/api/rpf/mlo/stats
```

ะัะฒะตั:
```json
{
  "success": true,
  "stats": {
    "total_interiors": 150,
    "total_archives": 45,
    "avg_per_archive": 3.33
  }
}
```

---

## ๐ Workflow

```
โโโโโโโโโโโโโโโโโโโโโโโ
โ ะะฐะณััะทะบะฐ ะฐััะธะฒะฐ     โ
โโโโโโโโโโโโฌโโโโโโโโโโโ
           โ
           v
โโโโโโโโโโโโโโโโโโโโโโโ
โ ะะฝะดะตะบัะฐัะธั          โ
โ (Unpacker)          โ
โโโโโโโโโโโโฌโโโโโโโโโโโ
           โ
           v
โโโโโโโโโโโโโโโโโโโโโโโ
โ ะกะบะฐะฝะธัะพะฒะฐะฝะธะต YMAP   โ
โ ะฝะฐ CMloInstanceDef  โ
โโโโโโโโโโโโฌโโโโโโโโโโโ
           โ
           v
โโโโโโโโโโโโโโโโโโโโโโโ
โ ะกะพััะฐะฝะตะฝะธะต ะฒ ะะ     โ
โ (rpf_interiors)     โ
โโโโโโโโโโโโฌโโโโโโโโโโโ
           โ
           v
โโโโโโโโโโโโโโโโโโโโโโโ
โ ะัะพะฑัะฐะถะตะฝะธะต ะฒ UI    โ
โ (InteriorsPage)     โ
โโโโโโโโโโโโฌโโโโโโโโโโโ
           โ
           v
โโโโโโโโโโโโโโโโโโโโโโโ
โ ะกะบะฐัะธะฒะฐะฝะธะต +        โ
โ ะขะตะปะตะฟะพััะฐัะธั        โ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะัะธะผะตัะฐะฝะธั

- ะะฝัะตััะตัั ะพะฟัะตะดะตะปััััั ะขะะะฌะะ ะฟะพ ัะธะฟั `CMloInstanceDef` ะฒ YMAP
- ะะฑััะฝัะต ะพะฑัะตะบัั (CEntityDef) ะะ ััะธัะฐัััั ะธะฝัะตััะตัะฐะผะธ
- ะะพะพัะดะธะฝะฐัั ะฑะตััััั ะฝะฐะฟััะผัั ะธะท YMAP ะฑะตะท ะฟัะตะพะฑัะฐะทะพะฒะฐะฝะธะน
- ะะพัะฐัะธั ััะฐะฝะธััั ะฒ ัะพัะผะฐัะต ะบะฒะฐัะตัะฝะธะพะฝะฐ (x, y, z, w)

---

## ๐ฏ ะกะปะตะดัััะธะต ัะฐะณะธ

- [ ] ะะพะฑะฐะฒะธัั ะฑะฐะทะพะฒัะต ะธะฝัะตััะตัั GTA V (ะฒะบะปะฐะดะบะฐ GTAV)
- [ ] ะะพะฑะฐะฒะธัั ัะบะฐะฝะธัะพะฒะฐะฝะธะต ะปะพะบะฐะปัะฝัั ะธะฝัะตััะตัะพะฒ (ะฒะบะปะฐะดะบะฐ Local)
- [ ] ะะพะฑะฐะฒะธัั ะฟัะตะฒัั/ัะบัะธะฝัะพัั ะธะฝัะตััะตัะพะฒ
- [ ] ะะพะฑะฐะฒะธัั ะบะฐัะตะณะพัะธะธ ะธ ัะธะปัััั
- [ ] ะะพะฑะฐะฒะธัั ะฟะพะธัะบ ะฟะพ ะธะฝัะตััะตัะฐะผ
- [ ] ะะพะฑะฐะฒะธัั ัะบัะฟะพัั ัะฟะธัะบะฐ ะธะฝัะตััะตัะพะฒ

---

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ ะฟัะพะฒะตัััะต:
1. ะะพะณะธ backend (`/app/logs/`)
2. ะะพะณะธ ALT:V ัะตัะฒะตัะฐ
3. ะะพะฝัะพะปั ะฑัะฐัะทะตัะฐ (F12)
4. ะขะฐะฑะปะธัั `rpf_interiors` ะฒ ะะ
